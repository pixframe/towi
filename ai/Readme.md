# Towi
 

## Overview 
Towi is a video game platform (developed by PixFrame Studios, Mexico City, Mexico) based on standardized tests that provides a neuropsychological profile of the subject, based on their responses on several games.

As the game begins, the subject is presented with the idea of going on a trip to an island named Towi, taking them through a ser- ies of tasks with this common theme. Towi is made of seven sepa- rate games: Boarding Pass, Packing, Drive to the Airport, Waiting Room, Fly the Plane, Pick up Coins and Unpacking. With the onset of each task instructions are presented as both text on the screen and as voice commands. The performance measures produced by each Towi game were intended to resemble as much as possible those from the standardized tests they were based on


### Games

As the game begins, the subject is presented with the idea of going on a trip to an island named Towi, taking them through a ser- ies of tasks with this common theme. Towi is made of seven sepa- rate games: Boarding Pass, Packing, Drive to the Airport, Waiting Room, Fly the Plane, Pick up Coins and Unpacking. With the onset of each task instructions are presented as both text on the screen and as voice commands. The performance measures produced by each Towi game were intended to resemble as much as possible those from the standardized tests they were based on. A summary of the content of each task, the performance metrics it produces and the NPSI or BANFE sub-test on which it is based can be found in Table 1.

In the Boarding Pass task, the Towi game starts by showing a log-in screen to the subject to the subject. In this task, the subject is asked to fill out the boarding pass with their name, age, country of residence, birth date and current date (Fig. 1a). The Boarding Pass is based on the NPSI: Orientation test, providing a gross mea- sure of how conscious the subject is regarding basic information (e.g., name, place of residence and current date).

The game proceeds to a screen showing a child’s room where an animal avatar presents the Packing task, in which the player must pack their luggage for a trip. A tutorial shows that in order to pack a suitcase, an object needs to be selected using the mouse and then they must click on the suitcase in order to pack it (Fig. 1b). Stimuli were presented verbally and on the screen in writing. Only when tutorial was performed correctly, will the actual task start. The player is then presented with a sequence of three objects to be located and packed in the same order as they were presented. If successful, the number of objects will increase by one until the subject fails twice on the same sequence. Afterwards, the screen will rotate to a different part of the room, when the subject is then asked to pack a list of items in reverse order. The packing list is pre- sented to the subject three times. The length of the sequences, starting at two, will increase after each trial. The test ends when the subject fails to recall the items twice in a row.

The Packing task was designed based on the NPSI: Forward and Backward Digits Span tests, where subjects are presented with sequences of positive integers and must repeat them back to the experimenter in same or reverse order. This task is designed to measure attention span, in the case where items are recalled in straight order and working memory, when items have to be recalled in reverse order. In both, Packing and NPSI: Digit Span, the maximum length of items remembered by the subject is logged. After the subject has finished packing, they are asked to remember a list of three items to unpack upon arrival to the island at the start of the Unpacking task (see below).

The next task, Drive to the Airport, involves using the mouse to drag the car that will take the subject to the airport through a maze, without hitting borders or crossing grassy areas

The task evaluates a total of three labyrinths. As the car moves, it leaves a visible track over the road. Also, visual feedback is given when the car hits a border, but the car is not physically blocked from crossing over. The Drive to the Airport task was designed to be solved in a very similar way as the BANFE: Labyrinths test, which is used to assess planning. While the Towi version includes a functional goal, the BANFE test only features the abstract goal of solving the labyrinth. In both, the subject can choose to move around the designated areas or to cross the labyrinth walls to get to the goal. Both tests produce similar measures: the number of dead ends, border crossings and total time. Drive to the Airport adds a couple of measures: the latency to start, that is, the moment when the subject decides to start moving the car, as well the num- ber of times the car hits the borders.

The Waiting Room task begins when the subject arrives at the airport. Flights are announced through the speaker always using two letters and two numbers  The subject must click the mouse every time a flight starting with ‘‘KW” is announced. A sin- gle trial tutorial is followed by a list of flights, which includes ten target stimuli. The task has a fixed duration of two minutes and 15 s. The Waiting Room task works in a very similar manner to the NPSI: Digit Detection, a test designed to evaluate sustained attention, in which the experimenter reads a list of numbers and the subject has to tap on the table each time a particular number is mentioned. The number of times the subject taps correctly, taps on an incorrect cue, or misses a tap on the correct cue is logged. Similarly, the number of times the subject clicks on a correct, incorrect or fails to click when a ‘‘KW” flight comes on the screen is counted.

In Fly the Plane, the subject is placed in the cockpit of the plane where arrows of different colors and directions appear on the cen- ter of the screen (Fig. 1e). The subject must press the arrows on the keyboard with the same direction as the one on the screen while ignoring green arrows. This is a Stroop test, a type of Go-No-Go task. In the NPSI: Stroop test, subjects were asked to call out printed color names (red, green, blue and brown) when the print ink was in a different color than the name of the colored word. The Stroop test has been traditionally used to measure inhibitory control [35]. In both Fly the Plane and NPSI: Stroop, the number of correct events and total time taken are logged. Because the stim- ulus appears automatically in Towi, the number of missed events is also logged.

In the Pick Up Coins task the subject is told that due to turbu- lence on the airplane, a jar transporting coins fell on the floor. Coins are shown flat, displaying a particular pattern on one of their sides and arranged on a grid (Fig. 1f). The subject is instructed to click on all of the coins whose faces match the target pattern. The subject may choose to end the task whenever he or she decides that all the correct coins have been picked up by clicking on a but- ton on the bottom of the screen. Coins are removed from the grid as they are picked up. The Pick Up Coins task was designed to be

| Task                     | Performance Metrics                                                                            | Based On                               | Cognitive Skill                        |
|--------------------------|------------------------------------------------------------------------------------------------|----------------------------------------|----------------------------------------|
| Boarding Pass            | None, but records are confirmed by experimenter                                                | NPSI: Orientation                      | Orientation                            |
| Packing                  | Longest successful series in direct and reverse order                                          | NPSI: Forward and Backward Digits Span | Attentional Span & Working Memory      |
| Drive to the airport     | Completion time, latency to start, number of hits, crosses and dead ends                       | Labyrinths (BANFE)                     | Planning                               |
| Waiting room             | Correct, incorrect and missed stimuli                                                          | NPSI: Digit detection                  | Attention sustained Inhibitory control |
| Flight the plane         | Correct, incorrect, missed stimuli and total time                                              | NPSI: Stroop                           | Selective attention                    |
| Pick up the coins        | Correct, incorrect, missed stimuli and total time                                              | NPSI: Visual Detection                 | Short term memory                      |
| Unpacking (first object) | Number of correctly recalled objects                                                           | NPSI: Memory Recall                    | Short term memory                      |
| Unpacking                | Number of correct items, intrusions, perseverations, semantic groupings, and spatial precision | NPSI: Word List                        | Short term memory                      |
  

## Business Goal

  

A video game for the neuropsychological screening of children

Statistical analysis was performed. Since many of the results produced by the Towi metrics do not have a normal distribution and no normative data is available, we used median and interquartile ranges (IQ1 – IQ3) as descriptive statistics to present performance metrics. We compared raw per- formance scores for each TOWI task with those produced by the corresponding neuropsychological tasks they were based on using Spearman’s rho and corrected for multiple comparisons using Holm’s correction (rs).

We calculated the correlation values between performance scores and age (rage) and used a Kruskal-Wallis test, followed by multiple comparisons, to compare performance between age groups (6–7, 8–10 and 10– 13 year olds).We also calculated the correlation between performance scores and the number of hours played daily  We compared the performance of boys and girls using a Wilcoxon Rank Sum and a rank-biserial correlation to assess the effect sizes on non-parametric data  Finally, to identify the factor structure of the Towi performance metrics, we performed an exploratory factor analysis using the fa function from the psych package  using the principal axis factor method.

-> Given the large age range of the subjects who participated in the study, we set out to understand the relation between age, performance, and with this find an effecitve method using machine learning, that can detect weather the user has a cognitive defficiency in any of the areas measured by the different set of games offered in towi.

 ## Arquitectural diagram

![Diagram](https://firebasestorage.googleapis.com/v0/b/towi-a1.appspot.com/o/Screen%20Shot%202021-11-13%20at%200.56.24.png?alt=media&token=0d2a2a6b-aa8b-4188-adad-9f469204eeb6)

In general the model is programmed and acceses through Noteboooks in Google Colab or in Google Cloud Data Lab, where the model is programmed, It has access to database CVS dumps through Google Cloud Storage for testing and training, then It is uploaded to a Google Cloud AI Platform auto-managed instance or clusted, and then it can be accessed and requested through the Predictions API

 ## Technology Stack

The model is programmed in Python using Scikit, Pandas, Tensorflow, Keras, sklearn, Numpy and matplotlib. The model is then served using Google Cloud AI Platform, that has an open core platform and software stack, running on Debian.

*  [AI Platform](https://console.cloud.google.com/mlengine)
*  [Google cloud platform](https://console.cloud.google.com)
*  [Python](https://www.python.org/downloads/)
* [Tensorflow](https://www.tensorflow.org/api_docs/python/tf)
* [Keras](https://keras.io/api/)
* [SciKit](https://scikit-learn.org/stable/getting_started.html)
* [Numpy](https://numpy.org/)
* [Matplotlib](https://matplotlib.org/)

## Data
[Test Data Set](https://github.com/pixframe/towi/tree/master/ai/dataset/towi_example_dataset.csv)

The variables used in each game's model:
![Diagram](https://firebasestorage.googleapis.com/v0/b/towi-a1.appspot.com/o/Screen%20Shot%202021-11-13%20at%201.25.05.png?alt=media&token=e7a85507-d016-478c-bd45-810f015bf507)
Using GMM and  KMeans clustering analysis on each game we can find the optimal amount of categories in the dataset to label each user and then use a Classification model to predict wather a new user could have some coginive disabilty or attention defficit disorder

The  elbow method  is a useful graphical tool to estimate the optimal number of clusters  _k_  for a given task. Intuitively, we can say that, if  _k_  increases, the within-cluster SSE (“distortion”) will decrease. This is because the samples will be closer to the centroids they are assigned to.

The idea behind the elbow method is to identify the value of  _k_ where the distortion begins to decrease most rapidly, which will become clearer if we plot the distortion for different values of  _k_: 

```
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.cm as cm
import seaborn as sns
from sklearn.cluster import KMeans
from sklearn.metrics import silhouette_samples, silhouette_score
%matplotlib inline

orignal_df = pd.read_csv("towi_dataset_v2.csv")
orignal_df.head(10)
wr_df = orignal_df[["playerAge",...,...]]

...
...

distortions = []
for i in range(1, 11):
km = KMeans(
n_clusters=i, init='random',
n_init=10, max_iter=300,
tol=1e-04, random_state=0)

km.fit(X)
distortions.append(km.inertia_)

# plot
plt.plot(range(1, 11), distortions, marker='o')
plt.xlabel('Number of clusters')
plt.ylabel('Distortion')
plt.show()
```

Other clustering algorithms and techniques used are:
-   **Silhouette plots**, another method used to select the optimal  _k_
-   **k-means++**, a variant of k-means, that improves clustering results through more clever seeding of the initial cluster centers.
  

## Installation Guide

### Before you begin

Complete the following steps to set up your development environment, install the required packages, set up your GCP project, and authenticate your GCP account[.

### Set up your local development environment

If you are using Colab or AI Platform Notebooks, your environment already meets all the requirements to run this notebook. You can skip this step. Otherwise, make sure your environment meets this notebook's requirements.



Set up your local development environment
If you are using Colab or AI Platform Notebooks, your environment already meets all the requirements to run this notebook. You can skip this step.

Otherwise, make sure your environment meets this notebook's requirements. You need the following:

-   **The Google Cloud SDK
-   **Git
-   **Python 3
-   **virtualenv
-   **Jupyter notebook running in a virtual environment with Python 3

The [Google Cloud guide to Setting up a Python development environment](https://cloud.google.com/python/setup) and the [Jupyter installation guide](https://jupyter.org/install) provide detailed instructions for meeting these requirements. The following steps provide a condensed set of instructions:

- [Install and initialize the Cloud SDK.](https://cloud.google.com/sdk/docs/)
- [Install Python 3.](https://cloud.google.com/python/setup#installing_python)
- Install virtualenv [Install virtualenv](https://cloud.google.com/python/setup#installing_and_using_virtualenv) and create a virtual environment that uses Python 3.
- Activate that environment and run pip install jupyter in a shell to install Jupyter.
- Run jupyter notebook in a shell to launch Jupyter.
- Open this notebook in the Jupyter Notebook Dashboard.

##### Set up your GCP project
The following steps are required, regardless of your notebook environment.

- Select or create a GCP project.. 
- Make sure that billing is enabled for your project.
- Enable the AI Platform APIs and Compute Engine APIs.
- Enter your project ID in the cell below. Then run the cell to make sure the Cloud SDK uses the right project for all the - commands in this notebook.

Note: Jupyter runs lines prefixed with ! as shell commands, and it interpolates Python variables prefixed with $ into these commands.
```
PROJECT_ID = "[your-project-id]" #@param {type:"string"}
! gcloud config set project $PROJECT_ID
```

#### Authenticate your GCP account
If you are using AI Platform Notebooks, your environment is already authenticated. Skip this step.

If you are using Colab, run the cell below and follow the instructions when prompted to authenticate your account via oAuth.

Otherwise, follow these steps:

- In the GCP Console, go to the Create service account [key page.](https://console.cloud.google.com/apis/credentials/serviceaccountkey)
- From the Service account drop-down list, select New service account.
- In the Service account name field, enter a name.
- From the Role drop-down list, select Machine Learning Engine > AI Platform Admin and Storage > Storage Object Admin.
- Click Create. A JSON file that contains your key downloads to your local environment.
- Enter the path to your service account key as the GOOGLE_APPLICATION_CREDENTIALS variable in the cell below and run the cell.
```
import sys

# If you are running this notebook in Colab, run this cell and follow the
# instructions to authenticate your GCP account. This provides access to your
# Cloud Storage bucket and lets you submit training jobs and prediction
# requests.

if 'google.colab' in sys.modules:
  from google.colab import auth as google_auth
  google_auth.authenticate_user()

# If you are running this notebook locally, replace the string below with the
# path to your service account key and run this cell to authenticate your GCP
# account.
else:
  %env GOOGLE_APPLICATION_CREDENTIALS ''
```

## User Guide

Please read [User guidel](https://drive.google.com/file/d/1tD4qtX4PgxdulKTIWFJhpDoaNGbRLJbw/view) for the platforms and games complete user guide.

Please read [Training Manual](https://drive.google.com/file/d/1ErmUgyseopu-qmYM5QgCD9CkaB_-hS1O/view) for details and specifics about the games.

Please read [Assesment and evaluations](https://drive.google.com/file/d/1H3Qe-ZW-CDXQZ9gvH7mkPrNm2pMlTU_Y/view) for details about the evaluations and report sheets.

  
  ## Integrations 

Please access our [backend integration guide](https://github.com/pixframe/towi/blob/master/README.md) for details on how to deploy, or contribute on our open source backend .

### Api reference
 You can access our backends api reference [here](https://towi.nyx.mx:2443/docs/) 

  ## Source code 

You can access all our source code [here](https://github.com/pixframe/towi/tree/master/ai) 

  

## Contributing

 
Please read [CONTRIBUTING.md](https://github.com/pixframe/towi/blob/master/CONTRIBUTING.md) for details on our code of conduct, and the process for submitting pull requests to us.


## Authors

  

* ****Pixframe Studios SAPI de CV****  - [Pixframe Studios](https://www.pixframestudios.com)

  

See also the list of [contributors](https://github.com/pixframe/towi/blob/master/CONTRIBUTORS.md) who participated in this project.

  

## License

  

This project is licensed under the GNU License - see the [LICENSE.md](https://github.com/pixframe/towi/blob/master/LICENSE) file for details

  

## Acknowledgments

  
* Unicef
* Publimetro
* Nyx Technologies